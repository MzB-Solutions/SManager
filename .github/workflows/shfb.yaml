name: SandcastleHelpFileBuilder
on:
  push:
    branches:
      - docs
  pull_request:
    branches:
      - docs
jobs:
  build-docs:
    runs-on: [windows-latest]
    steps:
    - name: Notify of Build start
      uses: sarisia/actions-status-discord@v1
      if: always()
      with:
        webhook: ${{ secrets.DISCORDBUILDSBOT }}
        status: ${{ job.status }}
        username: MzB Build Notifications
    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v1.0.2
    - name: Cache Sandcastle HelpFile Builder
      id: cache-shfb
      uses: actions/cache@v2
      env:
        cache-name: cache-shfb-choco
      with:
        path: C:\ProgramData\chocolatey\lib\sandcastle\
        key: ${{ runner.os }}-shfb-choco
        restore-keys: ${{ runner.os }}-shfb-choco
    - name: Install SandcasteHelpFileBuilder via Chocolatey (if !cached)
      if: steps.cache-shfb.outputs.cache-hit != 'true'
      run: choco install sandcastle
    - uses: actions/checkout@v2
      with:
        submodules: recursive
    - name: Build source to generate xml files and documentation
      run: |
        refeshenv
        dotnet restore
        dotnet build --no-restore --configuration Debug
        msbuild /p:Configuration=Documentation SystemT00ls-Full.sln
